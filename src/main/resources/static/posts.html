<!DOCTYPE html>
<html ng-app="PostApp">
<head>
<title>Post App</title>
<meta charset="utf-8">

<script
        src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
<script
        src="http://angular-ui.github.com/bootstrap/ui-bootstrap-tpls-0.1.0.js"></script>
<link
        href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/css/bootstrap-combined.min.css"
        rel="stylesheet">
<link rel="stylesheet" type="text/css" href="table.css" />
<link rel="stylesheet" type="text/css" href="posts.css" />


<script>
var app = angular.module('PostApp', ['ui.bootstrap']);

 function loadPosts ($scope, $http){
 	$http({
        method : 'GET',
	url: (window.location.hostname === 'localhost' ? 
		'http://localhost:8080/post' : 
		'http://cp-missingsemicolons.herokuapp.com/post')
        }).then(function (response) {
                $scope.posts = response.data;
		for (var j = 0; j < response.data.length; j++) {
			var tags = "";
			for (var i = 0; i < response.data[j].tags.length; i++) {
				tags += "#" + response.data[j].tags[i] + " ";
			}
			$scope.posts[j].tags = tags;
		}
        });
}

app.controller('PostCtrl', function ($scope, $http) {
        
        loadPosts($scope, $http);
  
        $scope.save = function(post) {
		var tags = $scope.post.tags.trim().split(/[#\s]+/);
		var postRequest = {
			method: 'POST',
			url: (window.location.hostname === 'localhost' ? 
				'http://localhost:8080/post' : 
				'http://cp-missingsemicolons.herokuapp.com/post'),
			data: {
				messageBody: $scope.post.messageBody,
				name: $scope.post.name,
				title: $scope.post.title,
				location: $scope.post.location,
				tags: tags
			}
		}
		$http(postRequest).then(function(response) {
			loadPosts($scope, $http);
			$scope.post = null;
		});
        };
  
});
</script>
</head>

<body>
	<div ng-controller="PostCtrl">
		<h1 class="header">International Activity Meter</h1>
		<input ng-model="post.name" placeholder="Name" class="txt-input" size="40"/>
		<br \>
		<input ng-model="post.title" placeholder="Title (Student/Professor)" 
			class="txt-input" size="40"/>
		<br \>
		<input ng-model="post.location" placeholder="Location" class="txt-input" size="40"/>
		<br \>
		<textarea ng-model="post.messageBody" placeholder="Write about your experiences!" 
			class="txt-input" rows="4" cols="1000" ></textarea>
		<br />
		<input ng-model="post.tags" placeholder="#tags" class="txt-input" size="40"/>
                <button ng-click="save(post)" class="button">Create Post</button>

		<table class="newsfeed">
                       	<tr ng-repeat="p in posts">
				<td>
				<div class="post">
					<b><font size="5">{{p.name}}</font></b><br />
					{{p.title}}<br />
					{{p.location}}<br /><br />
                        	       	<font size="5">
						{{p.messageBody}}
						{{p.tags}}
					</font>
				</div>
				</td>
                	</tr>
                </table>
        </div>
</body>
</html>
